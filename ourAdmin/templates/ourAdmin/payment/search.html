{% extends "ourAdmin/base.html" %}
{% load static %}

{% block custom_css %}
  <link href="{% static 'bower_components/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}

<section>
  <h3>{{Title}}</h3>

  <form method="post" accept-charset="utf-8" class="form-group" role="form" id="form-search" action="{% url 'PaymentSearchAjax' %}">
    {% csrf_token %}
    <div class="div-inline">
      <b>Fecha </b><br>
      <input type="text" name="date" data-date-format="dd/mm/yyyy" class="datepicker form-control" id="id_date">
    </div>
    
    <div class="div-inline">
      <b>Orden  </b> <br>
      <input type="text" name="order" maxlength="100" class="form-control" id="id_order">
    </div>

    <div class="div-inline">
      <button type="button" class="btn" id="btn-submit"><i class="fa fa-check" aria-hidden="true"></i></button>
    </div>
  </form>

  <table id="table-payment" class="table">
    
  </table>
</section>

{% endblock %}

{% block custom_script %}
<script type="text/javascript" src="{% static 'bower_components/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js' %}"></script>
<script>
  $( document ).on( 'submit', '#form-search', function(e){
      $.ajax({
        url : $( this ).attr( 'action' ),
        type : $( this ).attr( 'method' ),
        data : $( this ).serialize(), 
      })
      .done(function(data){
        var html = '<thead><tr><th>Fecha</th><th>ID Pago</th><th>ID Orden</th><th>MÃ©todo de pago</th><th>Usuario</th></tr></thead>';               
        //add products list to table if list's not empty
        if(data.length > 0){          
          for (var i = 0; i < data.length; i++){
              html +='<tbody><tr><td>'+data[i].date+'</a></td>\
                        <td>'+data[i].pk+'</td>\
                        <td>'+data[i].order+'</td>\
                        <td>'+data[i].paymentMethod+'</td>\
                        <td>'+data[i].user+'</td></tr></tbody>';
          }       
          $("#table-payment").html(html);
        }else{
          $("#table-payment").html('<tr><td>No se encontraron productos.</td></tr>');
        }
      })
      .fail(function( jqXHR, textStatus, errorThrown ){
        console.log("ERROR: ajax");
      });
      return false;
  });

  $(document).ready(function() {
      //Datepicker
      $('.datepicker').datepicker({
        //format: 'mm-dd-yyyy',
        endDate: '+0d',
        autoclose: true
      }).on('changeDate', function(e){
          $(this).datepicker('hide');
      });

      $("#btn-submit").click(function(){
        //verify that at least one field is filled
        if (document.getElementById("id_date").value != "" ||
            document.getElementById("id_order").value != "") {
          $("#form-search").submit();
        }else{
          $("#table-payment").html('<tr><td>Debe escribir un numero de orden o fecha del pago.</td></tr>');
        }
      });
  });
</script>

{% endblock %}  