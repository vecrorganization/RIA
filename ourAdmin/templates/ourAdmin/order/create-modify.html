{% extends "ourAdmin/base.html" %}
{% load static %}

{% block custom_css %}
{% endblock %}

{% block content-bar-list %}
  {% if pk %}
  <li class="active"><a href="#">Modificar</a></li>
  <li><a href="{% url 'OrderCreate' %}">Crear</a></li>
  {% else %}
  <li class="active"><a href="#">Crear</a></li>
  {% endif %}
  <li><a href="{% url 'OrderSearch' %}">Buscar</a></li>
{% endblock %}

{% block content %}

<section>
  <h3>Crear Orden</h3>

  <form method="post" accept-charset="utf-8" class="form-group" role="form" enctype="multipart/form-data">
    {% csrf_token %}    
    <table> {{ form.as_table }} </table>
    <button type="submit" class="btn" title="Guardar"><i class="fa fa-check" aria-hidden="true"></i></button>

    {% if pk %}
      <button type="button" id="btn-delete" class="btn" title="Eliminar"><i class="fa fa-trash" aria-hidden="true"></i></button>
    {% endif%}
  </form>
</section>

{% endblock %}

{% block custom_script %}
<script>
  $(document).ready(function() {
      $("#btn-delete").click(function(){
        $.ajax({
          data : {'pk': {{pk}}, csrfmiddlewaretoken: '{{ csrf_token }}'},
          url : '/ourAdmin/orderdeleteajax/',
          type : 'POST',     
          success : function(data){
            console.log(data);
            if(data.deleted == 1){
              window.location.href = "{% url 'OrderSearch' %}";
            }
            else{
              location.reload();
            }
          },
          error : function(data){
            console.log("ERROR: in orderdeleteajax");
          }
        });
      });
  });
</script>

{% endblock %}  