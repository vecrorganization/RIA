{% extends "ourAdmin/base.html" %}
{% load static %}

{% block custom_css %}
{% endblock %}

{% block content %}

<section>
  <h3>{{Title}}</h3>

  <form method="post" accept-charset="utf-8" class="form-group" role="form" enctype="multipart/form-data">
    {% csrf_token %}
    <table> {{ form.as_table }} </table>
    <button type="submit" class="btn"><i class="fa fa-check" aria-hidden="true"></i></button>
    <a href="{% url 'ProdSearch' %}">
      <button type="button" class="btn"><i class="fa fa-undo" aria-hidden="true"></i></button>
    </a>
    {% if pk %}
      <button type="button" id="btn-delete" class="btn" ><i class="fa fa-times" aria-hidden="true"></i></button>
    {% endif%}
  </form>
</section>

{% endblock %}

{% block custom_script %}

{% if pk %}
<script>
  $(document).ready(function() {
      $("#btn-delete").click(function(){
        $.ajax({
          data : {'pk': '{{pk}}', csrfmiddlewaretoken: '{{ csrf_token }}'},
          url : '/ourAdmin/proddeleteajax/',
          type : 'POST',     
          success : function(data){
            console.log(data);
            if(data.deleted == 1){
              window.location.href = "{% url 'ProdSearch' %}";
            }else{
              location.reload();
            }
          },
          error : function(data){
            console.log("ERROR: Prod delete ajax ");
          }
        });
      });
  });
</script>
{% endif %}

{% endblock %} 